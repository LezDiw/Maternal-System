<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maternal Care System - Patient Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #3b82f6;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        @media (min-width: 1024px) {
            .dashboard {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
        }

        .content-section, .form-section, .communication-section {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-section, .communication-section, .info-section {
            flex: 1;
        }

        .form-section h2, .communication-section h2, .info-section h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #1e40af;
        }

        form fieldset {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        form legend {
            font-weight: bold;
            color: #475569;
            padding: 0 0.5rem;
        }

        form label {
            display: block;
            margin-top: 1rem;
            font-weight: 500;
        }

        form input, form select, form textarea {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-sizing: border-box;
        }

        form textarea {
            min-height: 80px;
            resize: vertical;
        }

        .submit-btn {
            background-color: #2563eb;
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            width: 100%;
        }

        .submit-btn:hover {
            background-color: #1d4ed8;
        }

        .communication-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background-color: #e2e8f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
        }

        .chat-window {
            display: none;
            flex-direction: column;
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chat-window.active {
            display: flex;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 0.5rem;
            overflow-y: auto;
            max-height: 400px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .chat-messages .user-message {
            background-color: #e2f2ff;
            padding: 0.5rem;
            border-radius: 8px;
            align-self: flex-end;
            max-width: 80%;
        }
        .chat-messages .other-message {
            background-color: #f0f4f8;
            padding: 0.5rem;
            border-radius: 8px;
            align-self: flex-start;
            max-width: 80%;
        }
        
        .chat-messages .ai-message {
             background-color: #e2f2ff;
            padding: 0.5rem;
            border-radius: 8px;
            align-self: flex-start;
            max-width: 80%;
        }

        .chat-window input {
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-right: 0.5rem;
            flex: 1;
        }

        .send-btn {
            background-color: #22c55e;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .send-btn:hover {
            background-color: #15803d;
        }

        .alerts-section {
            margin-top: 2rem;
        }

        .alerts-section h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #ef4444;
            margin-bottom: 0.5rem;
        }

        .alerts-section ul {
            list-style: none;
            padding: 0;
        }

        .alerts-section li {
            background-color: #fecaca;
            color: #991b1b;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        #loading-indicator {
            display: none;
            text-align: center;
            padding: 1rem;
            color: #475569;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .info-section h3 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #1e40af;
        }
        
        .info-section ul {
            list-style-type: disc;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Maternal Care System - Patient Dashboard</h1>
    </header>

    <main class="dashboard">
        <section class="form-section">
            <h2>Medical History & Current Pregnancy</h2>
            <form id="medicalForm">
                <fieldset>
                    <legend>Personal Information</legend>
                    <label>Full Name:</label>
                    <input type="text" name="fullName" required>
                    <label>Date of Birth:</label>
                    <input type="date" name="dob" required>
                    <label>Contact Number:</label>
                    <input type="tel" name="contact" required>
                </fieldset>

                <fieldset>
                    <legend>Medical Background</legend>
                    <label>Blood Group:</label>
                    <select name="bloodGroup" required>
                        <option value="">Select</option>
                        <option>A+</option><option>A-</option>
                        <option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option>
                        <option>AB+</option><option>AB-</option>
                    </select>
                    <label>Allergies:</label>
                    <textarea name="allergies"></textarea>
                    <label>Pre-existing Conditions:</label>
                    <textarea name="conditions"></textarea>
                </fieldset>

                <fieldset>
                    <legend>Current Pregnancy</legend>
                    <label>Weeks of Gestation:</label>
                    <input type="number" name="gestationWeeks" min="0" max="42">
                    <label>Current Symptoms:</label>
                    <textarea name="currentSymptoms" id="currentSymptoms"></textarea>
                    <label>Current Medications:</label>
                    <textarea name="medications"></textarea>
                </fieldset>

                <button type="submit" class="submit-btn">Save Details</button>
            </form>
        </section>

        <section class="communication-section">
            <div class="chat-tabs">
                <button class="tab-btn active" data-tab="doctorChat">Doctor</button>
                <button class="tab-btn" data-tab="mothersChat">Mothers Group</button>
                <button class="tab-btn" data-tab="aiChat">AI Agent</button>
                <button class="tab-btn" data-tab="infoSection">Awareness</button>
            </div>

            <div class="chat-window active" id="doctorChat">
                <div class="flex items-center mb-4">
                    <label for="doctorSelect" class="font-medium mr-2">Select Doctor:</label>
                    <select id="doctorSelect" class="flex-1 p-2 border border-gray-300 rounded-md">
                       <option value="">Select a Doctor</option>
                    </select>
                </div>
                <div class="chat-messages" id="doctorMessages"></div>
                <div class="flex">
                    <input type="text" id="doctorInput" placeholder="Type message to Doctor...">
                    <button class="send-btn" onclick="sendMessage('doctor')">Send</button>
                </div>
            </div>

            <div class="chat-window" id="mothersChat">
                <div class="chat-messages" id="mothersMessages"></div>
                <div class="flex">
                    <input type="text" id="mothersInput" placeholder="Type message to Mothers Group...">
                    <button class="send-btn" onclick="sendMessage('mothers')">Send</button>
                </div>
            </div>

            <div class="chat-window" id="aiChat">
                <div class="chat-messages" id="aiMessages"></div>
                <div id="loading-indicator">AI Agent is typing...</div>
                <div class="flex">
                    <input type="text" id="aiInput" placeholder="Ask AI Agent about your pregnancy...">
                    <button class="send-btn" onclick="sendMessage('ai')">Send</button>
                </div>
            </div>
            
            <div class="content-section chat-window" id="infoSection">
                <h2>Maternal Mortality: Causes & Prevention</h2>
                <div class="info-content">
                    <p>Understanding the risks is key to a healthy pregnancy. Here's a summary of the major causes of maternal mortality and what you can do to stay safe, based on the research project.</p>
                    
                    <h3>Major Causes of Maternal Mortality</h3>
                    <p>The document highlights several key factors, often a mix of patient-related and healthcare-system issues:</p>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Severe Bleeding (Haemorrhage):</strong> This is the leading cause globally and in Kenya. It often occurs after childbirth (postpartum haemorrhage).</li>
                        <li><strong>Hypertensive Disorders:</strong> Conditions like <strong>preeclampsia</strong> and <strong>eclampsia</strong>, characterized by high blood pressure, are major contributors. Eclampsia can lead to seizures.</li>
                        <li><strong>Infections:</strong> Infections, such as <strong>puerperal sepsis</strong>, can occur after delivery and are a significant risk.</li>
                        <li><strong>Unsafe Abortions:</strong> These are a major cause of death, particularly in regions where they are not medically supervised.</li>
                        <li><strong>Lack of Awareness:</strong> Not knowing the danger signs of complications, leading to delays in seeking care.</li>
                        <li><strong>Healthcare System Failures:</strong> These include shortages of skilled staff, lack of access to emergency care, and delays in treatment.</li>
                    </ul>
                    
                    <h3>How to Know If You're Experiencing a Complication</h3>
                    <p>Early detection is vital. Be aware of these critical signs:</p>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Heavy Bleeding:</strong> Any bleeding, especially heavy bleeding, during or after pregnancy.</li>
                        <li><strong>Severe Headache:</strong> A persistent or severe headache, particularly with blurred vision, can be a sign of preeclampsia.</li>
                        <li><strong>High Fever:</strong> A high temperature can indicate a serious infection.</li>
                        <li><strong>Swelling:</strong> Sudden or excessive swelling in your face or hands.</li>
                        <li><strong>Severe Abdominal Pain:</strong> This can be a sign of a serious issue like placental abruption.</li>
                        <li><strong>Seizures or Coma:</strong> An emergency sign of eclampsia.</li>
                    </ul>
                    
                    <h3>What You Should Do (Immediate Measures)</h3>
                    <p>If you experience any of the above symptoms, do not wait. Take these steps immediately:</p>
                    <ol class="list-decimal pl-5 mb-4">
                        <li><strong>Contact a Doctor or Hospital:</strong> Use this app's chat feature to alert your doctor or call emergency services right away.</li>
                        <li><strong>Go to the Hospital:</strong> The fastest way to get help is to get to a medical facility. Do not delay.</li>
                        <li><strong>Communicate Clearly:</strong> Explain your symptoms to the healthcare provider as precisely as possible.</li>
                    </ol>
                    
                    <h3>Prevention is Key</h3>
                    <p>The best way to avoid complications is to stay proactive throughout your pregnancy:</p>
                    <ul class="list-disc pl-5 mb-4">
                        <li><strong>Attend all Antenatal Care (ANC) Appointments:</strong> Regular check-ups are essential for monitoring your health and the baby's.</li>
                        <li><strong>Educate Yourself:</strong> Learn about the stages of pregnancy and potential risks. Use this app's AI chat to ask questions.</li>
                        <li><strong>Maintain a Healthy Lifestyle:</strong> Eat a balanced diet, exercise regularly (as advised by your doctor), and avoid smoking and alcohol.</li>
                        <li><strong>Communicate:</strong> Talk to your doctor about any concerns you have, no matter how small they seem.</li>
                        <li><strong>Use the System:</strong> Update your symptoms and medical history in this dashboard so your healthcare provider has the most current information.</li>
                    </ul>
                </div>
            </div>

            <div class="alerts-section">
                <h3>Alerts</h3>
                <ul id="alertList"></ul>
                <h3>Reminders</h3>
                <ul id="reminderList">
                    <li>Next ANC visit: 15th August 2025</li>
                    <li>Blood test: 20th August 2025</li>
                </ul>
            </div>
    </section>
    </main>

    <div class="footer">
        <p id="userIdDisplay">User ID: N/A</p>
    </div>

    <script>
        const setupEventHandlers = () => {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.chat-window').forEach(w => w.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                });
            });

            document.getElementById('medicalForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());
                console.log("Saving form data:", data);
                alert("Medical details saved successfully (simulated). Check the console for the data.");
            });

            window.sendMessage = (type) => {
                let input, messagesDiv, simulatedResponse;

                if (type === 'doctor') {
                    input = document.getElementById('doctorInput');
                    messagesDiv = document.getElementById('doctorMessages');
                    simulatedResponse = "Thank you for your message. I'll get back to you shortly.";
                } else if (type === 'mothers') {
                    input = document.getElementById('mothersInput');
                    messagesDiv = document.getElementById('mothersMessages');
                    simulatedResponse = "That's a great question! I had a similar experience. What worked for me was...";
                } else if (type === 'ai') {
                    input = document.getElementById('aiInput');
                    messagesDiv = document.getElementById('aiMessages');
                    const lowerCaseMessage = input.value.toLowerCase();
                    const aiResponses = {
                        'preeclampsia': 'Preeclampsia is a serious condition in pregnancy characterized by high blood pressure. Key signs include persistent headaches, blurred vision, and sudden swelling in the face or hands.',
                        'bleeding': 'Heavy bleeding, also known as haemorrhage, is a major cause of maternal mortality. Any unusual or heavy bleeding should be reported to your doctor immediately.',
                        'fever': 'A high fever during or after pregnancy could be a sign of an infection, such as puerperal sepsis. It is crucial to seek urgent medical care.',
                        'haemorrhage': 'A haemorrhage is severe bleeding. It is the leading cause of maternal mortality globally and in Kenya, often occurring after childbirth. Prompt medical attention is vital if you experience heavy bleeding.',
                        'default': 'I am an AI agent here to provide you with basic information. Please ask me about pregnancy symptoms or common conditions like preeclampsia.',
                    };
                    let matchedResponse = aiResponses['default'];
                    for (const keyword in aiResponses) {
                        if (lowerCaseMessage.includes(keyword)) {
                            matchedResponse = aiResponses[keyword];
                            break;
                        }
                    }
                    simulatedResponse = matchedResponse;
                }
                
                const message = input.value.trim();
                if (!message) return;

                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'user-message';
                userMessageDiv.innerHTML = `<strong>You:</strong> ${message}`;
                messagesDiv.appendChild(userMessageDiv);

                input.value = '';

                if (type !== 'ai') {
                    setTimeout(() => {
                        const otherMessageDiv = document.createElement('div');
                        otherMessageDiv.className = 'other-message';
                        otherMessageDiv.innerHTML = `<strong>${type === 'doctor' ? 'Doctor' : 'Mothers Group'}:</strong> ${simulatedResponse}`;
                        messagesDiv.appendChild(otherMessageDiv);
                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    }, 1000);
                } else {
                    const loadingIndicator = document.getElementById('loading-indicator');
                    loadingIndicator.style.display = 'block';
                    setTimeout(() => {
                        loadingIndicator.style.display = 'none';
                        const aiMessageDiv = document.createElement('div');
                        aiMessageDiv.className = 'ai-message';
                        aiMessageDiv.innerHTML = `<strong>AI Agent:</strong> ${simulatedResponse}`;
                        messagesDiv.appendChild(aiMessageDiv);
                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    }, 1500);
                }
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            };

            document.getElementById('currentSymptoms').addEventListener('input', function () {
                const symptoms = this.value.toLowerCase();
                const alertList = document.getElementById('alertList');
                alertList.innerHTML = '';
                const dangerSigns = [
                    { keyword: 'bleeding', message: 'Possible severe bleeding (postpartum hemorrhage) — seek urgent care.' },
                    { keyword: 'severe headache', message: 'Could indicate preeclampsia — consult your doctor immediately.' },
                    { keyword: 'swelling', message: 'Swelling in face/hands may be a sign of high blood pressure.' },
                    { keyword: 'fever', message: 'Fever could be a sign of infection (puerperal sepsis) — seek urgent care.' },
                    { keyword: 'difficulty breathing', message: 'Difficulty breathing or chest pain can be a sign of a serious complication. Go to the hospital immediately.' },
                    { keyword: 'blurred vision', message: 'Sudden blurred vision can be a symptom of preeclampsia. Contact your doctor immediately.' },
                    { keyword: 'abdominal pain', message: 'Severe abdominal pain could be a sign of a number of issues. Contact your doctor or emergency services.' },
                    { keyword: 'unusual vaginal discharge', message: 'Unusual or foul-smelling discharge could be a sign of infection. Consult your doctor.' }
                ];
                dangerSigns.forEach(sign => {
                    if (symptoms.includes(sign.keyword)) {
                        const li = document.createElement('li');
                        li.textContent = sign.message;
                        alertList.appendChild(li);
                    }
                });
            });
        };
async function loadDoctors() {
    try {
        const response = await fetch('/get_doctors');
        const doctors = await response.json();

        const select = document.getElementById('doctorSelect');
        select.innerHTML = '<option value="">Select a Doctor</option>'; // reset

        doctors.forEach(doc => {
            const option = document.createElement('option');
            option.value = doc.id;
            option.textContent = `Dr. ${doc.name} (${doc.specialization})`;
            select.appendChild(option);
        });
    } catch (err) {
        console.error("Error loading doctors:", err);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    setupEventHandlers();
    loadDoctors(); // load doctors on page load
});

        // Initialize event handlers once the DOM is loaded
        // document.addEventListener('DOMContentLoaded', setupEventHandlers);
    </script>
</body>
</html>